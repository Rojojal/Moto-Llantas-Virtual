<!DOCTYPE html>
<html class="h-full" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
  <head th:replace="~{layout/layout :: head}">
    <title>Taller Llantas</title>
  </head>
  <body class="flex flex-col min-h-screen">

    <!-- Filtro de productos -->
    <section th:fragment="filterProducts">
      <form th:action="@{/catalog/catalog}" method="get" class="mb-6 flex flex-wrap justify-center gap-4">
        <input type="text" name="keyword" th:value="${keyword}" placeholder="Buscar por nombre o categor√≠a" class="border border-gray-300 rounded px-4 py-2 w-64 shadow-sm" />
        <select name="category" class="border border-gray-300 rounded px-4 py-2">
          <option value="">-- Filtrar por categor√≠a --</option>
          <option th:each="cat : ${categories}" th:value="${cat}" th:text="${cat}" th:selected="${cat == selectedCategory}"></option>
        </select>
        <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition">Buscar</button>
        <a th:href="@{/catalog/catalog}" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400 transition">Limpiar</a>
      </form>
    </section>

    <!-- Cat√°logo de productos -->
    <section th:fragment="catalog">
        <div class="container mx-auto px-4 py-8">
            <h1 class="text-3xl font-bold mb-10 text-center text-gray-800">Cat√°logo de Productos</h1>

            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8">
                <div th:each="product : ${products}"
                     class="bg-white rounded-xl shadow-md hover:shadow-lg transition transform hover:-translate-y-1 flex flex-col justify-between">

                    <!-- Imagen -->
                    <div class="p-4 flex justify-center items-center bg-gray-50 rounded-t-xl">
                        <img th:if="${product.imageUrl != null}"
                             th:src="${product.imageUrl}"
                             alt="Imagen de producto"
                             class="w-full h-48 object-contain rounded-md" />
                        <p th:if="${product.imageUrl == null}"
                           class="text-gray-400 italic">Imagen no disponible</p>
                    </div>

                    <!-- Informaci√≥n -->
                    <div class="p-4 flex-grow flex flex-col">
                        <h2 class="text-lg font-semibold text-center mb-2 text-gray-800" th:text="${product.name}">Nombre</h2>
                        <p class="text-gray-600 text-sm mb-3 text-center line-clamp-3" th:text="${product.description}">Descripci√≥n</p>
                        <p class="text-green-600 font-bold text-xl mb-4 text-center" th:text="'‚Ç°' + ${product.price}">‚Ç°0</p>

                        <!-- Botones -->
                        <div class="mt-auto space-y-2">
                            <a th:href="@{'/catalog/productDetails/' + ${product.id}}"
                               class="block px-4 py-2 text-center bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                                Ver detalles
                            </a>
                            <form th:action="@{/cart/add}" method="post">
                                <input type="hidden" name="productId" th:value="${product.id}" />
                                <input type="hidden" name="quantity" value="1" />
                                <button type="submit"
                                        class="w-full px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-medium">
                                    Agregar al carrito
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>





    <section th:fragment="productDetails" class="max-w-6xl mx-auto bg-white shadow-xl rounded-2xl overflow-hidden mt-10 p-6">
        <div class="md:flex md:gap-8">
            <!-- Galer√≠a de im√°genes -->
            <div class="md:w-1/2">
                <!-- Imagen principal -->
                <div class="flex justify-center items-center bg-gray-50 rounded-xl p-5 shadow-inner mb-4">
                    <img th:if="${product.imageUrl != null}"
                         th:src="${product.imageUrl}"
                         alt="Imagen de producto"
                         class="max-h-96 w-full object-contain rounded-lg shadow-md transition-transform duration-300 hover:scale-105" />
                    <p th:if="${product.imageUrl == null}" class="text-gray-400 italic">Imagen no disponible</p>
                </div>
            </div>

            <!-- Detalles del producto -->
            <div class="md:w-1/2 flex flex-col justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-4 text-gray-800" th:text="${product.name}">Nombre del producto</h1>
                    <p class="text-gray-700 mb-6 whitespace-pre-line leading-relaxed" th:text="${product.description}">Descripci√≥n del producto</p>

                    <!-- Informaci√≥n adicional -->
                    <div class="space-y-3 text-gray-700">
                        <p><span class="font-semibold">Categor√≠a: </span><span th:text="${product.category}">Categor√≠a</span></p>
                        <p><span class="font-semibold">Stock disponible: </span><span th:text="${product.stock}">0</span></p>
                        <p>
                            <span class="font-semibold">Fecha de vencimiento: </span>
                            <span th:if="${product.expirationDate != null}"
                                  th:text="${#temporals.format(product.expirationDate, 'dd/MM/yyyy')}">dd/MM/yyyy</span>
                            <span th:unless="${product.expirationDate != null}" class="italic text-gray-500">No aplicable</span>
                        </p>
                    </div>

                    <!-- Precio destacado -->
                    <p class="text-3xl font-bold text-green-600 mt-6 mb-4" th:text="'‚Ç°' + ${product.price}">‚Ç°0</p>
                </div>

                <!-- Botones de acci√≥n -->
                <div class="mt-6 space-y-3">
                    <form th:action="@{/cart/add}" method="post" class="w-full">
                        <input type="hidden" name="productId" th:value="${product.id}" />
                        <input type="hidden" name="quantity" value="1" />
                        <button type="submit"
                                class="w-full px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition font-semibold shadow">
                            üõí Agregar al carrito
                        </button>
                    </form>
                    <a th:href="@{/catalog/catalog}"
                       class="block w-full text-center px-4 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-semibold shadow">
                        ‚Üê Volver al cat√°logo
                    </a>
                </div>

                <!-- Redes sociales -->
                <div class="mt-6 flex gap-3" sec:authorize="isAuthenticated()">
                    <a class="p-3 border rounded-lg hover:bg-gray-100" th:href="@{'https://www.facebook.com/sharer/sharer.php'(u=${productUrl})}" target="_blank" title="Compartir en Facebook">üìò</a>
                    <a class="p-3 border rounded-lg hover:bg-gray-100" th:href="@{'https://wa.me/'(text=${shareText + ' ' + productUrl})}" target="_blank" title="Compartir en WhatsApp">üí¨</a>
                    <a class="p-3 border rounded-lg hover:bg-gray-100" th:href="@{'https://twitter.com/intent/tweet'(text=${shareText}, url=${productUrl})}" target="_blank" title="Compartir en X">‚úñ</a>
                    <button type="button" class="p-3 border rounded-lg hover:bg-gray-100"
                            th:attr="data-title=${product.name},data-text=${shareText},data-url=${productUrl}"
                            onclick="shareNative(this)" title="Compartir">üîó</button>
                </div>
            </div>
        </div>
    </section>
    </body>
</html>
